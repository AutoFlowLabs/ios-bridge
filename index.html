<!doctype html><meta charset="utf-8">
<video id="v" autoplay playsinline style="border:1px solid #888"></video>
<script>
const pc = new RTCPeerConnection();
const ws = new WebSocket(`ws://${location.hostname}:8765`);

pc.ontrack = e => (v.srcObject = e.streams[0]);

document.body.onclick = ev =>
  ws.send(JSON.stringify({t:"tap",x:ev.clientX,y:ev.clientY}));

(async () => {                         // very thin signalling
  const offer = await pc.createOffer({offerToReceiveVideo:1});
  await pc.setLocalDescription(offer);
  const resp = await fetch('/sdp',{method:'POST',body:offer.sdp});
  await pc.setRemoteDescription({type:'answer',sdp:await resp.text()});
})();
</script>


<!-- Replace the coordinate mapping section in the canvas.onclick function: -->

<!-- Update both setupVideoStream and setupScreenshotMode functions: -->

<!-- Replace the canvas.onclick function with this corrected version: -->

<!-- Add these functions after the existing JavaScript functions: -->

<!-- Replace the setupHighPerformanceVideoStream function: -->

<script>
    // Add performance optimization variables
    let frameBuffer = [];
    let isDrawing = false;
    let requestedAnimationFrame = null;
    
   
    
   
</script>